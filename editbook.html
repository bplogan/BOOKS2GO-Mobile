<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">	
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>books2go</title>
	 <link rel="stylesheet" href="css/jquery.mobile-1.4.3.min.css" />
	<link rel="stylesheet" href="css/styles.css" />
	<script src="js/jquery-1.10.2.min.js"></script>
	<script src="js/jquery.mobile-1.4.3.min.js"></script>
	<script src="js/main.js"></script>
	<script>
	
	


	</script>
	<script id="panel-init">
		$(function() {
			$( "body>[data-role='panel']" ).panel();
		});
	</script>
	
	
	
</head>

<body >

<div id="editBookPage" data-role="page" data-ajax="false">
<div data-role="header" data-position="fixed" data-theme="a" id="header">		<div data-role="navbar" id="head-buttons" data-iconpos="top">					</div>	</div><!-- header -->
	
	
	<div data-role="content" id="content">
		<div>
		
			<p class='logop'><img class='logo' src="images/logo3.png" alt="" /></p>
			
			<div id="crumbdiv" >
				<ul id="crumb"  data-role="listview" data-filter="false" data-inset="false" data-theme="a" >
					<li><a class='ui-btn ui-btn-icon-left ui-icon-carat-l'  href='mybooks.html' data-ajax='false'>Back to my books</a></li>
				</ul>
			</div>
			
			<div class="text" id="search">
				<div id="editdiv">					
						
					
					<form id="frm-edit">
						<input type="hidden" id="txt-isbn"  />
						<fieldset>
							<label for="ddl-school">School</label>
							<select id="ddl-school"></select>
						</fieldset>
						
						<fieldset>
							<label for="txt-course">Course</label>
							<input type="text" id="txt-course" data-clear-btn="true"  />
						</fieldset>
						
						<fieldset>
							<label for="txt-course2">Course 2</label>
							<input type="text" id="txt-course2" data-clear-btn="true" />
						</fieldset>
						
						<fieldset>
							<label for="txt-price">Price</label>
							<input type="number" id="txt-price" required data-clear-btn="true"  />
						</fieldset>
						
						<fieldset>
							<label for="txt-desc">Description</label>
							<textarea id="txt-desc"></textarea>
						</fieldset>
						
						<fieldset>
							<label for="ddl-condition">Condition</label>
							<select id="ddl-condition">
				        		<option value="0">Book condition</option>
				        		<option value="1">Excellent</option>
				        		<option value="2">Very Good</option>
				        		<option value="3">Good</option>
				        		<option value="4">Average</option>
				        		<option value="5">Poor</option>
				        		<option value="6">Very Poor</option>
				        		<option value="7">Horrible</option>
				        	</select>
						</fieldset>
						
						<fieldset>
							<label for="txt-title">Title</label>
							<input type="text" id="txt-title" required data-clear-btn="true"  />
						</fieldset>
						
						<fieldset>
							<label for="txt-edition">Edition</label>
							<input type="text" id="txt-edition" data-clear-btn="true"  />
						</fieldset>
						
						<fieldset>
							<label for="txt-author1">Author 1</label>
							<input type="text" id="txt-author1"  data-clear-btn="true" />
						</fieldset>
						
						<fieldset>
							<label for="txt-author2">Author 2</label>
							<input type="text" id="txt-author2"  data-clear-btn="true" />
						</fieldset>
						
						<fieldset>
							<label for="txt-author3">Author 3</label>
							<input type="text" id="txt-author3"  data-clear-btn="true" />
						</fieldset>
						
						<fieldset>
							<label for="txt-pages">Pages</label>
							<input type="number" id="txt-pages"  data-clear-btn="true" />
						</fieldset>
						
						<fieldset>
							 <div id="err"></div> 
							 <button id="btn-search" type="submit" data-icon="check" style="background-color: #BCED91">Update</button>
						</fieldset>
					</form>
				
				</div>
			</div>	
			
			
			
			
	
	
	
		
	</div>
         
	</div>

  



<div data-role="panel" id="mypanel" data-theme="a" style='padding:0;margin:0;'>
<img src="images/logo3.png" width="100%" />
   <div style="height:30px"></div>
   <ul data-role="listview" id="menu">
   <li><a href="javascript:GoHome()" data-rel="close" data-ajax="false">Home</a></li>

  <li><a href="search.html" data-rel="close" data-ajax="false">Search</a></li>
  <li id="uprofile" style="display:none" data-role="collapsible" data-iconpos="right" data-inset="false">
    <h2>Profile</h2>
    <ul data-role="listview" data-theme="a">
     <li><a href="mybooks.html" data-rel="close" data-ajax="false">&nbsp; - My books</a></li>
      <li><a href="postbook.html" data-rel="close" data-ajax="false">&nbsp; - Post a textbook</a></li>
      <li><a href="inbox.html" data-rel="close" data-ajax="false">&nbsp; - Inbox</a></li>
      <li><a href="wishlist.html" data-rel="close" data-ajax="false">&nbsp; - Wish list</a></li>
      <li><a href="editprofile.html" data-rel="close" data-ajax="false">&nbsp; - Edit profile</a></li>
      <li><a href="editschools.html" data-rel="close" data-ajax="false">&nbsp; - Edit schools</a></li>
      <li><a href="changepassword.html" data-rel="close" data-ajax="false">&nbsp; - Change password</a></li>
    </ul>
  </li>
   <li style="display:none" id="logout"><a href="logout.html" data-rel="user" data-ajax="false">Log out</a></li>
  <li style="display:none" id="login"><a href="login.html" data-rel="user" data-ajax="false">Log In</a></li>
  
</ul>
</div><!-- /panel -->


<script>
$(document).on('pagebeforecreate', '#editBookPage', function(){       	LoadHeader();});
$(document).on("pagebeforeshow","#editBookPage",function(){ // When entering pagetwo
	
	
});
$(document).on("pageshow","#editBookPage",function(){
	LoadHeader();
	GetBookInfo();
	if(window.localStorage.getItem("user_id")){
		if(window.localStorage.getItem("user_id") > 0){
			$("#uprofile").show();
			$("#logout").show();
			$("#login").hide();
			
		}
	}else{
		localStorage.clear();
		window.location = "index.html";
	}
	
	GetInboxCount();

	
});

function UpdateBook(){
	
	
	var UID = window.localStorage.getItem("user_id");
	var BID = window.localStorage.getItem("EBID");
	var schoolid = $("#ddl-school").val();
	var course = $("#txt-course").val();
	var course2 = $("#txt-course2").val();
	var price = $("#txt-price").val();
	var desc = $("#txt-desc").val();
	var condition = $("#ddl-condition").val();
	var title = $("#txt-title").val();
	var edition = $("#txt-edition").val();
	var author1 = $("#txt-author1").val();
	var author2 = $("#txt-author2").val();
	var author3 = $("#txt-author3").val();
	var pages = $("#txt-pages").val();
	var isbn = $("#txt-isbn").val();
	
	$.ajax({
        type: "POST",
        url: "http://www.books2go.ca/mobiservice/edit_book.php",
        data: {'UID' : UID, 'b' : BID,'schoolid' : schoolid,'course' : course,'course2' : course2,
        	'price' : price,
        	'desc' : desc,
        	'condition' : condition,
        	'title' : title,
        	'edition' : edition,
        	'author1' : author1,
        	'author2' : author2,
        	'author3' : author3,
        	'pages' : pages,
        	'isbn' : isbn
        	},
        dataType: "json",
        success: function(data) {
        	showErrorMessage("Your book was updated successfully!", $("#err"), 0);
        	setTimeout(function() {
        		window.location = "mybooks.html";
        	}, 3000);
        },
 	 	error: function(xhr, desc, err) {
       showErrorMessage(xhr + " Details: " + desc + "\nError:" + err, $("#err"), 0);
       }
   });         		
	
}

function GetBookInfo(){
	var UID = window.localStorage.getItem("user_id");
	var BID = window.localStorage.getItem("EBID");
	
	$.ajax({
        type: "POST",
        url: "http://www.books2go.ca/mobiservice/book.php",
        data: {'UID' : UID, 'b' : BID, 'edit' : '1'},
        dataType: "json",
        success: function(data) {
        	$("#ddl-school").empty().append(data.schools);
        	$("#ddl-school").val(data.school).selectmenu('refresh');
    		$("#ddl-school").selectmenu("refresh");
    		$("#txt-course").val(data.course);
    		$("#txt-course2").val(data.course2);
    		$("#txt-price").val(data.price);
    		$("#txt-desc").val(data.desc);
    		
    		$("#ddl-condition").val(data.condition).selectmenu('refresh');
    		$("#txt-title").val(data.title);
    		$("#txt-edition").val(data.edition);
    		$("#txt-author1").val(data.author1);
    		$("#txt-author2").val(data.author2);
    		$("#txt-author3").val(data.author3);
    		$("#txt-pages").val(data.pages);
    		$("#txt-isbn").val(data.isbn);
    		
    		 
        },
 	 	error: function(xhr, desc, err) {
       showErrorMessage(xhr + " Details: " + desc + "\nError:" + err, $("#err"), 0);
       }
   });         		
}

$('#frm-edit').submit(function (e) {
    e.preventDefault();
    UpdateBook();
});
	</script>

</div><!-- /page -->



</body>
</html>
