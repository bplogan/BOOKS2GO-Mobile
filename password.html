<html>

<head>

	<meta name="viewport" content="width=device-width, initial-scale=1">	

	<meta http-equiv="Content-type" content="text/html; charset=utf-8">

	<title>books2go</title>

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

	<link rel="stylesheet" href="css/styles.css" />

	<script src="js/jquery-1.10.2.min.js"></script>

	<script src="js/jquery.mobile-1.4.3.min.js"></script>

	<script src="js/main.js"></script>

	<script>



	



	</script>

	<script id="panel-init">

		

	</script>

</head>



<body>



<div id="passwordPage" data-role="page" >

	<div data-role="header" data-position="fixed" data-theme="a">

      	<div data-role="controlgroup" data-type="horizontal" class="ui-btn-left">

    		<a href="#mypanel" data-role="button" data-icon="bars" data-iconpos="notext">Menu</a>

    		

        </div>

        <h6></h6>

        

    

 </div><!-- header -->

	

	

	<div data-role="content" id="content">

		

		<div>

			<p class='logop'><img class='logo' src="images/logo3.png" alt="" /></p>

			<div class="text">
				<div id="div-email" style="display:none">
					<form id="frm-password">
						<fieldset>
							<label for="txt-email" style="text-align:center">Please enter your email address.  We'll send you a code to verify your account.</label>
							<input type="email" id="txt-email" required placeholder="email"  data-clear-btn="true"/>
						</fieldset>
						<fieldset>
							
							<button id="btn-code" type="button" onclick="GenerateCode(0)" data-icon="user" style="background-color: #BCED91">Continue</button>
						</fieldset>
					</form>					
				</div>
				
				<div id="div-code" style="display:none">
					<form id="frm-code">
						<fieldset>
							<label for="txt-code" style="text-align:center">Please enter the 5-digit code that was sent to <span id="span-email"></span></label>
							<input type="text" id="txt-code" required placeholder="code"  data-clear-btn="true"/>
						</fieldset>
						<fieldset>
						<label for="txt-pass" style="text-align:center">Please enter a new password</label>
							<input type="password" id="txt-pass" required placeholder="password"  data-clear-btn="true"/>
							<label for="txt-pass2" style="text-align:center">Confirm password</label>
							<input type="password" id="txt-pass2" required placeholder="confirm password"  data-clear-btn="true"/>
						</fieldset>
						<fieldset>
							
							<button id="btn-login" type="button" onclick="ResetPassword()" data-icon="user" style="background-color: #BCED91">Continue</button>
							<p style="text-align:center"><a href="javascript:GenerateCode(1)">Resend Code</a></p>
						</fieldset>
					</form>			
				</div>
				
			
				
				<p id="err" class="err" style="display:none"></p>
			</div>

			

		

			

		</div>

		

         

	</div>





  <div data-role="footer" data-position="fixed" class="ui-bar" style="text-align:center">


    <div id="anon-foot" >

    	<a data-ajax="false" data-shadow="false" data-corner="false" href="login.html" data-role="button" data-icon="user" data-iconpos="top" style="width:29%;background-color:transparent !important;color:#3A4E5C;border:none;text-shadow:0 0 0;" >Login</a>

    	<a data-ajax="false" data-shadow="false" data-corner="false"  href="register.html" data-role="button" data-icon="gear" data-iconpos="top" style="width:29%;background-color:transparent !important;color:#3A4E5C;border:none;text-shadow:0 0 0;border-left:1px solid #75838D;border-right:1px solid #75838D" >Register</a>

    	<a data-ajax="false" data-shadow="false" data-corner="false"  href="search.html" data-role="button" data-icon="search" data-iconpos="top" style="width:29%;background-color:transparent !important;color:#3A4E5C;border:none;text-shadow:0 0 0;" >Search</a>

		

    </div>

  </div>





<div data-role="panel" id="mypanel" data-theme="a" style='padding:0;margin:0;'>

	

   <img src="images/logo3.png" width="100%" />

   <div style="height:30px"></div>

   <ul data-role="listview">

   <li><a href="index.html" data-rel="close">Home</a></li>

   <li><a href="search.html"data-rel="close">Search</a></li>

 

   

  

</ul>

</div><!-- /panel -->



<script>

$(document).on("pagebeforeshow","#passwordPage",function(){ // When entering pagetwo
	
	$("#div-email").show();
	

		if(window.localStorage.getItem("email") !== undefined && window.localStorage.getItem("email") !== null ){
			$("#txt-email").val(window.localStorage.getItem("email"));
		}
});



function GenerateCode(re){
	alert("gern");
	$("#err").html("");
	$("#err").hide();
	$("#div-code").hide();
	var email = $("#txt-email").val();
	alert("sdfds");
	if(email.trim() !== ""){
		alert("go");
		$.ajax({
	        type: "POST",
	        url: "http://www.books2go.ca/mobiservice/get_code.php",
	        data: {'EMAIL' : email},
	        dataType: "json",
	        success: function(data) {
	        	alert("success");
	        	if(data.result > 0){
	        		$("#span-email").html($("#txt-email").val());
	       			$("#div-email").hide();
	       			$("#div-code").show();
	       			if(re > 0){
	       				showErrorMessage("Code has been sent!", $("#err"), 0);
	       			}
	        	}else{
	        		$("#err").html("Email address was not found.");
	        		$("#err").show();
	        	}
	
			},
	
	 		error: function(xhr, desc, err) {
	       		alert(xhr + desc + err);
		    }
	
	   });  

	}else{

		showErrorMessage("Please enter your email and password", $("#err"), 0);

}

}
 
function ResetPassword(){
	
	$("#err").html("");
	$("#err").hide();
	
	var code = $("#txt-code").val();
	var pass = $("#txt-pass").val();
	var pass2 = $("#txt-pass2").val();
	var email = $("#txt-email").val();
	
	if(code.trim() !== "" && pass.trim() !== "" && pass2.trim() !== ""){
		
		$.ajax({
	        type: "POST",
	        url: "http://www.books2go.ca/mobiservice/reset_password.php",
	        data: {'EMAIL' : email,'CODE': code, 'PASS' : pass, 'PASS2' : pass2},
	        dataType: "json",
	        success: function(data) {
	        	
	        	if(data.result > 0){

	        		showErrorMessage("Your password was reset successfully.", $("#err"), 0);
	        		setTimeout(function(){
					  window.location = "login.html";
					}, 2000);
	        	}else{
	        		$("#err").html(data.error);
	        		$("#err").show();
	        	}
	
			},
	
	 		error: function(xhr, desc, err) {
	       		alert(xhr + desc + err);
		    }
	
	   });  

	}else{

		showErrorMessage("All fields are mandatory", $("#err"), 0);

}

}
 





$(window).keypress(function(event) {
	
	if (event.keyCode == '13') {
		
		event.preventDefault();
		if($("#div-email").is(":visible") ){
			GenerateCode(0);
		}else{
			ResetPassword();
		}
		
	}



});





</script>



</div><!-- /page -->







</body>

</html>

